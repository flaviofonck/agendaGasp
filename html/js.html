<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<script>

    function insertarContacto() 
    {
        // Obtenemos los datos del formulario
        let nombre = document.getElementById('nombre').value;
        let correo = document.getElementById('correo').value;
        let telefono = document.getElementById('telefono').value;

        // eliminamos la tabla
        eliminarTabla();
        crearLoaderPuntos('divContactos');

        google.script.run
        .withSuccessHandler(Contactoinsertadocorrectamente)
        .withFailureHandler(ContactoInsertadoError)
        .insertarContacto(nombre, correo, telefono);
    }

    function Contactoinsertadocorrectamente() 
    {
        // Limpiar formulario
        document.getElementById('formulario').reset();
        // document.getElementById('nombre').value = "";
        // document.getElementById('correo').value = "";
        // document.getElementById('telefono').value = "";

        //Mostrar notificacion de error
        crearNotificacion(NOTIIFCACION_OK, 'Se ha insertado correctamente el contacto', 'Contacto insertado');
        eliminarLoader();
        crearTablaContactos();
    }

    function ContactoInsertadoError(){
        //Mostrar notificacion de error
        crearNotificacion(NOTIIFCACION_DANGER, 'No se ha insertado correctamente el contacto', 'Error al insertar contacto');
        eliminarLoader();
        crearTablaContactos();
    }

    function crearTablaContactos() 
    {

        eliminarTabla();
        // Crear loader

        crearLoaderAnillos('divContactos');

        google.script.run
        .withSuccessHandler(crearTablaContactoscorrectamente)
        .withFailureHandler(crearTablaContactosError)
        .obtenerContactos();
    }
    
    function crearTablaContactosError() 
    {
        //Mostrar notificacion de error
        crearNotificacion(NOTIIFCACION_DANGER, 'No se ha cargado correctamente los datos', 'Error al crear Tabla');
        eliminarLoader();
    }


    function crearTablaContactoscorrectamente(obj) 
    {
        const tabla = document.createElement('table');
        tabla.id = 'tablaContactos';
        const tablaHeader = document.createElement('thead');
        const tablabody = document.createElement('tbody');
        
        for (let i = 0; i < obj.length; i++) {
            const filaActual = obj[i];
            const fila = document.createElement('tr');
            
            for (let j = 0; j < filaActual.length; j++) {
                const celdaActual = filaActual[j];
                const celda = i === 0 ? document.createElement('th') : document.createElement('td');
                celda.textContent = celdaActual;
                fila.appendChild(celda);
            }
            
            (i === 0 ? tablaHeader : tablabody).appendChild(fila);
        }
        
        tablaHeader.classList.add('table-dark');
        tabla.appendChild(tablaHeader);
        tabla.appendChild(tablabody);
        tabla.classList.add('table', 'table-striped', 'border', 'border-4', 'border-dark');
        
        document.getElementById('divContactos').appendChild(tabla);

        crearNotificacion(NOTIIFCACION_OK, 'Se ha creado la tabla correctamente', 'Tabla creada');
        eliminarLoader();
    }

    const NOTIIFCACION_OK = 1;
    const NOTIIFCACION_DANGER = 2;
    const NOTIIFCACION_WARNING = 3;

    function crearNotificacion(tipo, mensaje, titulo) 
    {
        let  mensajeNotificacion = document.getElementById('mensajenotificacion');
        let  tituloNotificacion = document.getElementById('titulonotificacion');
        let  elementnotificacion = document.getElementById('notifiacion');
        let  icononotificacion = document.getElementById('icononotificacion');
        let  notificacion = bootstrap.Toast.getOrCreateInstance(elementnotificacion);

        // Editar notificacion
        mensajeNotificacion.textContent = mensaje;
        tituloNotificacion.textContent = titulo;

        switch (tipo) {
            case NOTIIFCACION_OK:
                elementnotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-oscuro');
                icononotificacion.className = '';
                icononotificacion.classList.add('bi','bi-check2-square');
                break;
            case NOTIIFCACION_DANGER:
                elementnotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-oscuro');
                icononotificacion.className = '';
                icononotificacion.classList.add('bi','bi-bug');
                break;
            case NOTIIFCACION_WARNING:
                elementnotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-oscuro');
                icononotificacion.className = '';
                icononotificacion.classList.add('bi','bi-exclamation-square');
                break;
            default:
                break;
        }


        // Mostrar notificacion
        notificacion.show();
    }

    function crearLoader(elementoPadre)
    {
        eliminarLoader();
        let loader = document.createElement('div');
        loader.id = 'loader';
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        return document.getElementById(elementoPadre).appendChild(loader);
    }

    function crearLoaderPuntos(elementoPadre)
    {
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ellipsis');
    }

    function crearLoaderAnillos(elementoPadre)
    {
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ring');
    }

    function eliminarLoader()
    {
        let loader = document.getElementById('loader');
        if(loader) loader.remove();
    }

    function eliminarTabla() 
    {
        let tabla = document.getElementById('tablaContactos');
        if (tabla) tabla.remove();
    }
    
</script>

 <script>
    function crearTablaContactos_1()
    {
        let tabla = document.getElementById('tablaContactos');
        if (tabla) tabla.remove();
        google.script.run.withSuccessHandler(
            function(obj)
            {
                let tabla = document.createElement('table');
                tabla.id = 'tablaContactos';
                let tablaHeader = document.createElement('thead');
                let tablabody = document.createElement('tbody');
                Array.from(obj).forEach((filaActual, i) => 
                {
                    let fila = document.createElement('tr');
                    filaActual.forEach( celdaActual => 
                    {
                        let celda = document.createElement('td');
                        celda.textContent = celdaActual;
                        fila.appendChild(celda);
                    });
                    if(i == 0)
                    {
                        tablaHeader.appendChild(fila);
                        tabla.appendChild(tablaHeader);
                    }else
                    {
                        tablabody.appendChild(fila);
                    }
                });
                // agregamos clases a la cabecera
                tablaHeader.classList.add('table-dark');
                // agregamos el cuerpo de la tabla
                tabla.appendChild(tablabody);
                // agregamos las clases de la tabla
                tabla.classList.add('table','table-striped','border','border-3');
                // agregamos la tabla al document
                document.getElementById('divContactos').appendChild(tabla);
 
            }).obtenerContactos();
    }

    function crearTablaContactos_gpt() {
        const tablaExistente = document.getElementById('tablaContactos');
        if (tablaExistente) tablaExistente.remove();

        google.script.run.withSuccessHandler(function(obj) {
            const tabla = document.createElement('table');
            tabla.id = 'tablaContactos';
            const tablaHeader = document.createElement('thead');
            const tablabody = document.createElement('tbody');

            obj.forEach((filaActual, i) => {
                const fila = document.createElement('tr');
                filaActual.forEach(celdaActual => {
                    const celda = i === 0 ? document.createElement('th') : document.createElement('td');
                    celda.textContent = celdaActual;
                    fila.appendChild(celda);
                });

                (i === 0 ? tablaHeader : tablabody).appendChild(fila);
            });

            tablaHeader.classList.add('table-dark');
            tabla.appendChild(tablaHeader);
            tabla.appendChild(tablabody);
            tabla.classList.add('table', 'table-striped', 'border', 'border-3');

            document.getElementById('divContactos').appendChild(tabla);
        }).obtenerContactos();
    }
</script>
